!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:e(t)}(window,(function(t){"use strict";if(!t)throw new Error("FrostUI-Autocomplete requires a Window.");if(!("UI"in t))throw new Error("FrostUI-Autocomplete requires FrostUI.");const e=t.Core,s=t.dom,i=(t.QuerySet,t.UI),n=t.document;class o extends i.BaseComponent{constructor(t,s){let i;super(t,s),this._data=[],this._getData=null,this._getResults=null,e.isFunction(this._settings.getResults)?(this._getResultsCallbackInit(),this._getResultsInit()):e.isArray(this._settings.data)&&(i=this._settings.data),i&&(this._data=i,this._getDataInit()),this._render(),this._events()}dispose(){this._popper&&(this._popper.dispose(),this._popper=null),s.removeEvent(this._node,"focus.ui.autocomplete"),s.remove(this._menuNode),this._menuNode=null,this._itemsList=null,this._data=null,this._lookup=null,this._value=null,this._request=null,super.dispose()}hide(){return!this._animating&&s.isConnected(this._menuNode)&&s.triggerOne(this._node,"hide.ui.autocomplete")?(this._animating=!0,s.fadeOut(this._menuNode,{duration:this._settings.duration}).then(t=>{s.empty(this._itemsList),s.detach(this._menuNode),s.setAttribute(this._node,"aria-expanded",!1),s.triggerEvent(this._node,"hidden.ui.autocomplete")}).catch(t=>{}).finally(t=>{this._animating=!1}),this):this}show(){if(this._animating||s.is(this._node,":disabled")||s.hasAttribute(this._node,"readonly")||s.isConnected(this._menuNode)||!s.triggerOne(this._node,"show.ui.autocomplete"))return this;const t=s.getValue(this._node);return this._getData({term:t}),this._animating=!0,this._settings.appendTo?s.append(n.body,this._menuNode):s.after(this._node,this._menuNode),this.update(),s.fadeIn(this._menuNode,{duration:this._settings.duration}).then(t=>{s.setAttribute(this._node,"aria-expanded",!0),s.triggerEvent(this._node,"shown.ui.autocomplete")}).catch(t=>{}).finally(t=>{this._animating=!1}),this}toggle(){return s.isConnected(this._menuNode)?this.hide():this.show()}update(){return this._popper.update(),this}}Object.assign(o.prototype,{_events(){s.addEventDelegate(this._menuNode,"contextmenu.ui.autocomplete",'[data-ui-action="select"]',t=>{t.preventDefault()}),s.addEventDelegate(this._itemsList,"mousedown.ui.autocomplete",'[data-ui-action="select"]',t=>{t.preventDefault()}),s.addEventDelegate(this._itemsList,"mouseup.ui.autocomplete",'[data-ui-action="select"]',t=>{t.preventDefault();const e=s.getDataset(t.currentTarget,"uiValue");s.setValue(this._node,e),s.triggerEvent(this._node,"change.ui.autocomplete"),this.hide(),s.focus(this._node)}),s.addEventDelegate(this._itemsList,"mouseover.ui.autocomplete",'[data-ui-action="select"]',DOM.debounce(t=>{const e=s.find("[data-ui-focus]",this._itemsList);s.removeClass(e,this.constructor.classes.focus),s.removeDataset(e,"uiFocus"),s.addClass(t.currentTarget,this.constructor.classes.focus),s.setDataset(t.currentTarget,"uiFocus",!0)})),s.addEvent(this._node,"keydown.ui.autocomplete",t=>{if(!["ArrowDown","ArrowUp","Enter","Escape"].includes(t.code))return;if("Escape"===t.code)return void s.blur(this._node);const e=s.findOne("[data-ui-focus]",this._itemsList);if("Enter"===t.code){if(e){const t=s.getDataset(e,"uiValue");s.setValue(this._node,t),s.triggerEvent(this._node,"change.ui.autocomplete"),this.hide()}return}if(t.preventDefault(),!s.isConnected(this._menuNode))return void this.show();let i;if(e)switch(t.code){case"ArrowDown":i=s.nextAll(e,'[data-ui-action="select"]').shift();break;case"ArrowUp":i=s.prevAll(e,'[data-ui-action="select"]').pop()}else i=s.findOne('[data-ui-action="select"]',this._itemsList);i&&(s.removeClass(e,this.constructor.classes.focus),s.removeDataset(e,"uiFocus"),s.addClass(i,this.constructor.classes.focus),s.setDataset(i,"uiFocus",!0))});const t=e.debounce(t=>{this._settings.minLength&&t.length<this._settings.minLength?s.hide(this._menuNode):(s.empty(this._itemsList),s.isConnected(this._menuNode)?this._getData({term:t}):this.show())},this._settings.debounceInput);s.addEvent(this._node,"input.ui.autocomplete",DOM.debounce(e=>{const i=s.getValue(this._node);t(i)})),this._settings.getResults&&s.addEvent(this._itemsList,"scroll.ui.autocomplete",e.throttle(t=>{if(this._request||!this._showMore)return;const e=s.height(this._itemsList),i=s.height(this._itemsList,DOM.SCROLL_BOX);if(s.getScrollY(this._itemsList)>=i-e-e/4){const t=s.getValue(this._node),e=this._data.length;this._getData({term:t,offset:e})}},250,!1)),s.addEvent(this._node,"blur.ui.autocomplete",t=>{this.hide()}),s.addEvent(this._node,"keydown.ui.autocomplete",t=>{/^.$/u.test(t.key)&&this.show()})}}),Object.assign(o.prototype,{_getDataInit(){this._getData=({term:t=null})=>{if(this._settings.minSearch&&(!t||t.length<this._settings.minSearch))return this.update();const e=this._settings.sortResults(this._data,t).filter(e=>this._settings.isMatch(e,t));this._renderResults(e),this.update()}},_getResultsInit(){this._getData=({offset:t=0,term:e=null})=>{if(this._request&&this._request.cancel&&(this._request.cancel(),this._request=null),t||s.empty(this._itemsList),this._settings.minSearch&&(!e||e.length<this._settings.minSearch))return this.update();s.hide(this._menuNode);const i=this._getResults({offset:t,term:e});i.then(t=>{this._renderResults(t.results)}).catch(t=>{}).finally(t=>{this.update(),this._request===i&&(this._request=null)})}},_getResultsCallbackInit(){this._getResults=t=>{t.offset||(this._data=[]);const e=this._settings.getResults(t);return this._request=Promise.resolve(e),this._request.then(t=>{const e=this.constructor._parseData(t.results);return this._data.push(...e),this._showMore=t.showMore,Object.assign(this._lookup,this.constructor._parseDataLookup(this._data)),t}),this._request}}}),Object.assign(o.prototype,{_render(){this._menuNode=s.create("div",{class:this.constructor.classes.menu}),this._itemsList=s.create("div",{class:this.constructor.classes.items}),s.append(this._menuNode,this._itemsList);const t={reference:this._node,placement:this._settings.placement,position:this._settings.position,fixed:this._settings.fixed,spacing:this._settings.spacing,minContact:this._settings.minContact};this._settings.fullWidth&&(t.afterUpdate=(t,e)=>{const i=s.width(e,DOM.BORDER_BOX);s.setStyle(t,"width",i)},t.beforeUpdate=t=>{s.setStyle(t,"width","")}),this._popper=new i.Popper(this._menuNode,t)},_renderItem(t){const e=s.getValue(this._node)===t,i=s.create("div",{html:this._settings.sanitize(this._settings.renderResult(t,e)),class:this.constructor.classes.item,dataset:{uiAction:"select",uiValue:t}});return e&&s.addClass(i,this.constructor.classes.active),i},_renderResults(t){if(!t.length)return void s.hide(this._menuNode);s.show(this._menuNode);for(const e of t){const t=this._renderItem(e);s.append(this._itemsList,t)}let e=s.findOne("[data-ui-active]",this._itemsList);e||(e=s.findOne('[data-ui-action="select"]',this._itemsList)),e&&(s.addClass(e,this.constructor.classes.focus),s.setDataset(e,"uiFocus",!0))}}),o.defaults={data:null,getResults:null,isMatch:(t,s)=>{const i=t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),n=e.escapeRegExp(s),o=new RegExp(n,"i");return o.test(t)||o.test(i)},renderResult:t=>t,sanitize:t=>s.sanitize(t),sortResults:(t,e)=>t.sort((t,s)=>{const i=t.toLowerCase(),n=s.toLowerCase();if(e){const t=i.indexOf(e)-n.indexOf(e);if(t)return t}return i.localeCompare(n)}),minLength:1,debounceInput:250,duration:100,appendTo:null,fullWidth:!1,placement:"bottom",position:"start",fixed:!1,spacing:0,minContact:!1},o.classes={active:"autocomplete-active",focus:"autocomplete-focus",item:"autocomplete-item",items:"autocomplete-items",menu:"autocomplete-menu shadow-sm"},i.initComponent("autocomplete",o),i.Autocomplete=o}));