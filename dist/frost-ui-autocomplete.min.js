!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:e(t)}(window,(function(t){"use strict";if(!t)throw new Error("FrostUI-Autocomplete requires a Window.");if(!("UI"in t))throw new Error("FrostUI-Autocomplete requires FrostUI.");const e=t.Core,s=t.DOM,i=t.dom,o=t.UI,n=t.document;class a extends o.BaseComponent{constructor(t,s){let i;super(t,s),this._data=[],this._getData=null,this._getResults=null,e.isFunction(this._settings.getResults)?(this._getResultsCallbackInit(),this._getResultsInit()):e.isArray(this._settings.data)&&(i=this._settings.data),i&&(this._data=i,this._getDataInit()),this._render(),this._events()}dispose(){this._popper&&(this._popper.dispose(),this._popper=null),i.removeEvent(this._node,"keydown.ui.autocomplete"),i.removeEvent(this._node,"keyup.ui.autocomplete"),i.removeEvent(this._node,"input.ui.autocomplete"),i.removeEvent(this._node,"blur.ui.autocomplete"),i.remove(this._menuNode),this._menuNode=null,this._itemsList=null,this._data=null,this._value=null,this._request=null,this._popperOptions=null,this._getData=null,this._getResults=null,super.dispose()}hide(){return!this._animating&&i.isConnected(this._menuNode)&&i.triggerOne(this._node,"hide.ui.autocomplete")?(this._animating=!0,i.fadeOut(this._menuNode,{duration:this._settings.duration}).then((t=>{this._popper.dispose(),this._popper=null,i.empty(this._itemsList),i.detach(this._menuNode),i.setAttribute(this._node,"aria-expanded",!1),i.triggerEvent(this._node,"hidden.ui.autocomplete")})).catch((t=>{})).finally((t=>{this._animating=!1})),this):this}show(){if(this._animating||i.is(this._node,":disabled")||i.hasAttribute(this._node,"readonly")||i.isConnected(this._menuNode)||!i.triggerOne(this._node,"show.ui.autocomplete"))return this;const t=i.getValue(this._node);return this._getData({term:t}),this._animating=!0,this._settings.appendTo?i.append(this._settings.appendTo,this._menuNode):i.after(this._node,this._menuNode),this._popper=new o.Popper(this._menuNode,this._popperOptions),i.fadeIn(this._menuNode,{duration:this._settings.duration}).then((t=>{i.setAttribute(this._node,"aria-expanded",!0),i.triggerEvent(this._node,"shown.ui.autocomplete")})).catch((t=>{})).finally((t=>{this._animating=!1})),this}toggle(){return i.isConnected(this._menuNode)?this.hide():this.show()}update(){return this._popper&&this._popper.update(),this}}Object.assign(a.prototype,{_events(){i.addEventDelegate(this._menuNode,"contextmenu.ui.autocomplete",'[data-ui-action="select"]',(t=>{t.preventDefault()})),i.addEventDelegate(this._itemsList,"mousedown.ui.autocomplete",'[data-ui-action="select"]',(t=>{t.preventDefault()})),i.addEvent(this._node,"blur.ui.autocomplete",(t=>{i.isSame(this._node,n.activeElement)||(i.stop(this._menuNode),this._animating=!1,this.hide())})),i.addEventDelegate(this._itemsList,"mouseup.ui.autocomplete",'[data-ui-action="select"]',(t=>{t.preventDefault();const e=i.getDataset(t.currentTarget,"uiValue");e!==i.getValue(this._node)&&(i.setValue(this._node,e),i.triggerEvent(this._node,"change.ui.autocomplete")),this.hide(),i.focus(this._node)})),i.addEventDelegate(this._itemsList,"mouseover.ui.autocomplete",'[data-ui-action="select"]',s.debounce((t=>{const e=i.find("[data-ui-focus]",this._itemsList);i.removeClass(e,this.constructor.classes.focus),i.removeDataset(e,"uiFocus"),i.addClass(t.currentTarget,this.constructor.classes.focus),i.setDataset(t.currentTarget,"uiFocus",!0)})));const t=e.debounce((t=>{this._getData({term:t})}),this._settings.debounceInput);i.addEvent(this._node,"input.ui.autocomplete",s.debounce((e=>{this.show();const s=i.getValue(this._node);t(s)}))),i.addEvent(this._node,"keydown.ui.autocomplete",(t=>{if(!["ArrowDown","ArrowUp","Enter"].includes(t.code))return;const e=i.findOne("[data-ui-focus]",this._itemsList);if("Enter"===t.code){if(e){const t=i.getDataset(e,"uiValue");t!==i.getValue(this._node)&&(i.setValue(this._node,t),i.triggerEvent(this._node,"change.ui.autocomplete")),this.hide()}return}if(t.preventDefault(),!i.isConnected(this._menuNode))return this.show();let s;if(e)switch(t.code){case"ArrowDown":s=i.nextAll(e,'[data-ui-action="select"]').shift();break;case"ArrowUp":s=i.prevAll(e,'[data-ui-action="select"]').pop()}else s=i.findOne('[data-ui-action="select"]',this._itemsList);if(!e&&!s){const t=i.getValue(this._node);return this._getData({term:t})}if(!s)return;i.removeClass(e,this.constructor.classes.focus),i.removeDataset(e,"uiFocus"),i.addClass(s,this.constructor.classes.focus),i.setDataset(s,"uiFocus",!0);const o=i.getScrollY(this._itemsList),n=i.rect(this._itemsList,!0),a=i.rect(s,!0);a.top<n.top?i.setScrollY(this._itemsList,o+a.top-n.top):a.bottom>n.bottom&&i.setScrollY(this._itemsList,o+a.bottom-n.bottom)})),i.addEvent(this._node,"keyup.ui.autocomplete",(t=>{"Escape"===t.code&&i.isConnected(this._menuNode)&&(t.stopPropagation(),this.hide())})),this._settings.getResults&&i.addEvent(this._itemsList,"scroll.ui.autocomplete",e.throttle((t=>{if(this._request||!this._showMore)return;const e=i.height(this._itemsList),o=i.height(this._itemsList,s.SCROLL_BOX);if(i.getScrollY(this._itemsList)>=o-e-e/4){const t=i.getValue(this._node),e=this._data.length;this._getData({term:t,offset:e})}}),250,!1))}}),Object.assign(a.prototype,{_getDataInit(){this._getData=({term:t=null})=>{let e;i.empty(this._itemsList),e=this._settings.minSearch&&(!t||t.length<this._settings.minSearch)?[]:this._settings.sortResults(this._data,t).filter((e=>this._settings.isMatch(e,t))),this._renderResults(e),this.update()}},_getResultsInit(){this._getData=({offset:t=0,term:e=null})=>{if(this._request&&this._request.cancel&&(this._request.cancel(),this._request=null),t||i.empty(this._itemsList),this._settings.minSearch&&(!e||e.length<this._settings.minSearch))return this._renderResults([]),void this.update();const s={offset:t};e&&(s.term=e),i.hide(this._menuNode);const o=this._getResults(s);o.then((t=>{this._renderResults(t.results)})).catch((t=>{})).finally((t=>{this.update(),this._request===o&&(this._request=null)}))}},_getResultsCallbackInit(){this._getResults=t=>{t.offset||(this._data=[]);const e=this._settings.getResults(t);return this._request=Promise.resolve(e),this._request.then((t=>{this._data.push(...t.results),this._showMore=t.showMore})),this._request}}}),Object.assign(a.prototype,{_render(){this._menuNode=i.create("div",{class:this.constructor.classes.menu}),this._itemsList=i.create("div",{class:this.constructor.classes.items}),i.append(this._menuNode,this._itemsList),this._popperOptions={reference:this._node,placement:this._settings.placement,position:this._settings.position,fixed:this._settings.fixed,spacing:this._settings.spacing,minContact:this._settings.minContact},this._settings.fullWidth&&(this._popperOptions.afterUpdate=(t,e)=>{const o=i.width(e,s.BORDER_BOX);i.setStyle(t,"width",o)},this._popperOptions.beforeUpdate=t=>{i.setStyle(t,"width","")})},_renderItem(t){const e=i.getValue(this._node)===t,s=i.create("div",{html:this._settings.sanitize(this._settings.renderResult(t,e)),class:this.constructor.classes.item,dataset:{uiAction:"select",uiValue:t}});return e&&i.addClass(s,this.constructor.classes.active),s},_renderResults(t){if(!t.length)return void i.hide(this._menuNode);i.show(this._menuNode);for(const e of t){const t=this._renderItem(e);i.append(this._itemsList,t)}let e=i.findOne("[data-ui-active]",this._itemsList);e||(e=i.findOne('[data-ui-action="select"]',this._itemsList)),e&&(i.addClass(e,this.constructor.classes.focus),i.setDataset(e,"uiFocus",!0))}}),a.defaults={data:null,getResults:null,isMatch:(t,s)=>{const i=t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),o=e.escapeRegExp(s),n=new RegExp(o,"i");return n.test(t)||n.test(i)},renderResult:t=>t,sanitize:t=>i.sanitize(t),sortResults:(t,e)=>t.sort(((t,s)=>{const i=t.toLowerCase(),o=s.toLowerCase();if(e){const t=i.indexOf(e)-o.indexOf(e);if(t)return t}return i.localeCompare(o)})),minSearch:1,debounceInput:250,duration:100,appendTo:null,fullWidth:!1,placement:"bottom",position:"start",fixed:!1,spacing:0,minContact:!1},a.classes={active:"autocomplete-active",focus:"autocomplete-focus",item:"autocomplete-item",items:"autocomplete-items",menu:"autocomplete-menu shadow-sm"},o.initComponent("autocomplete",a),o.Autocomplete=a}));