{"version":3,"names":["Autocomplete","BaseComponent","constructor","node","options","super","this","_data","_activeItems","_getData","_getResults","_options","getResults","_getResultsCallbackInit","_getResultsInit","data","_getDataInit","_render","_events","dispose","_popper","$","remove","_menuNode","removeEvent","_node","removeAttribute","_loader","_error","_value","_requests","_popperOptions","hide","isConnected","getDataset","triggerOne","setDataset","uiAnimating","fadeOut","duration","then","_","empty","detach","removeDataset","setAttribute","triggerEvent","catch","show","is","hasAttribute","term","getValue","appendTo","append","after","Popper","fadeIn","toggle","update","defaults","lang","error","loading","value","_isString","text","renderResult","sanitize","input","isMatch","escapedTerm","_escapeRegExp","regExp","RegExp","test","normalized","normalize","replace","sortResults","a","b","aLower","toLowerCase","bLower","diff","indexOf","localeCompare","minSearch","debounce","maxHeight","fullWidth","placement","position","fixed","spacing","minContact","classes","active","focus","info","item","items","menu","proto","prototype","addEventDelegate","e","preventDefault","addEvent","isSame","document","activeElement","stop","currentTarget","setValue","focusedNode","find","removeClass","addClass","uiFocus","id","getAttribute","includes","code","findOne","focusNode","focusIndex","_request","itemsScrollY","getScrollY","itemsRect","rect","offset","nodeRect","top","setScrollY","bottom","stopPropagation","_throttle","_loadingScroll","_showMore","height","scrollHeight","boxSize","SCROLL_BOX","length","leading","results","bind","filter","sort","_renderResults","request","Promise","resolve","response","push","showMore","load","_debounce","finally","cancel","children","lastChild","child","generateId","create","class","style","attributes","role","_renderInfo","reference","beforeUpdate","setStyle","width","afterUpdate","BORDER_BOX","html","_renderItem","element","type","dataset","uiAction","uiValue","content","setHTML","_isElement","initComponent"],"sources":["../src/js/autocomplete.js","../src/js/index.js","../src/js/prototype/events.js","../src/js/prototype/data.js","../src/js/prototype/render.js"],"sourcesContent":["import $ from '@fr0st/query';\nimport { BaseComponent, Popper } from '@fr0st/ui';\n\n/**\n * Autocomplete Class\n * @class\n */\nexport default class Autocomplete extends BaseComponent {\n    /**\n     * New Autocomplete constructor.\n     * @param {HTMLElement} node The input node.\n     * @param {object} [options] The options to create the Autocomplete with.\n     */\n    constructor(node, options) {\n        super(node, options);\n\n        this._data = [];\n        this._activeItems = [];\n\n        this._getData = null;\n        this._getResults = null;\n\n        if (this._options.getResults) {\n            this._getResultsCallbackInit();\n            this._getResultsInit();\n        } else if (this._options.data) {\n            this._data = this._options.data;\n            this._getDataInit();\n        }\n\n        this._render();\n        this._events();\n    }\n\n    /**\n     * Dispose the Autocomplete.\n     */\n    dispose() {\n        if (this._popper) {\n            this._popper.dispose();\n            this._popper = null;\n        }\n\n        $.remove(this._menuNode);\n        $.removeEvent(this._node, 'keydown.ui.autocomplete');\n        $.removeEvent(this._node, 'keyup.ui.autocomplete');\n        $.removeEvent(this._node, 'input.ui.autocomplete');\n        $.removeEvent(this._node, 'blur.ui.autocomplete');\n        $.removeAttribute(this._node, 'role');\n        $.removeAttribute(this._node, 'aria-controls');\n        $.removeAttribute(this._node, 'aria-autocomplete');\n        $.removeAttribute(this._node, 'aria-expanded');\n        $.removeAttribute(this._node, 'aria-activedescendent');\n\n        this._menuNode = null;\n        this._loader = null;\n        this._error = null;\n        this._data = null;\n        this._activeItems = null;\n        this._value = null;\n        this._requests = null;\n        this._popperOptions = null;\n        this._getData = null;\n        this._getResults = null;\n\n        super.dispose();\n    }\n\n    /**\n     * Hide the Autocomplete.\n     */\n    hide() {\n        if (\n            !$.isConnected(this._menuNode) ||\n            $.getDataset(this._menuNode, 'uiAnimating') ||\n            !$.triggerOne(this._node, 'hide.ui.autocomplete')\n        ) {\n            return;\n        }\n\n        $.setDataset(this._menuNode, { uiAnimating: 'out' });\n\n        $.fadeOut(this._menuNode, {\n            duration: this._options.duration,\n        }).then((_) => {\n            this._popper.dispose();\n            this._popper = null;\n\n            this._activeItems = [];\n            $.empty(this._menuNode);\n            $.detach(this._menuNode);\n            $.removeDataset(this._menuNode, 'uiAnimating');\n            $.setAttribute(this._node, {\n                'aria-expanded': false,\n                'aria-activedescendent': '',\n            });\n            $.triggerEvent(this._node, 'hidden.ui.autocomplete');\n        }).catch((_) => {\n            if ($.getDataset(this._menuNode, 'uiAnimating') === 'out') {\n                $.removeDataset(this._menuNode, 'uiAnimating');\n            }\n        });\n    }\n\n    /**\n     * Show the Autocomplete.\n     */\n    show() {\n        if (\n            $.is(this._node, ':disabled') ||\n            $.hasAttribute(this._node, 'readonly') ||\n            $.isConnected(this._menuNode) ||\n            $.getDataset(this._menuNode, 'uiAnimating') ||\n            !$.triggerOne(this._node, 'show.ui.autocomplete')\n        ) {\n            return;\n        }\n\n        const term = $.getValue(this._node);\n        this._getData({ term });\n\n        $.setDataset(this._menuNode, { uiAnimating: 'in' });\n\n        if (this._options.appendTo) {\n            $.append(this._options.appendTo, this._menuNode);\n        } else {\n            $.after(this._node, this._menuNode);\n        }\n\n        this._popper = new Popper(this._menuNode, this._popperOptions);\n\n        $.fadeIn(this._menuNode, {\n            duration: this._options.duration,\n        }).then((_) => {\n            $.removeDataset(this._menuNode, 'uiAnimating');\n            $.setAttribute(this._node, { 'aria-expanded': true });\n            $.triggerEvent(this._node, 'shown.ui.autocomplete');\n        }).catch((_) => {\n            if ($.getDataset(this._menuNode, 'uiAnimating') === 'in') {\n                $.removeDataset(this._menuNode, 'uiAnimating');\n            }\n        });\n    }\n\n    /**\n     * Toggle the Autocomplete.\n     */\n    toggle() {\n        if ($.isConnected(this._menuNode)) {\n            this.hide();\n        } else {\n            this.show();\n        }\n    }\n\n    /**\n     * Update the Autocomplete position.\n     */\n    update() {\n        if (this._popper) {\n            this._popper.update();\n        }\n    }\n}\n","import $ from '@fr0st/query';\nimport { initComponent } from '@fr0st/ui';\nimport Autocomplete from './autocomplete.js';\nimport { _getDataInit, _getResultsCallbackInit, _getResultsInit } from './prototype/data.js';\nimport { _events } from './prototype/events.js';\nimport { _render, _renderInfo, _renderItem, _renderResults } from './prototype/render.js';\n\n// Autocomplete default options\nAutocomplete.defaults = {\n    lang: {\n        error: 'Error loading data.',\n        loading: 'Loading..',\n    },\n    data: null,\n    getResults: null,\n    getValue: (value) => $._isString(value) ?\n        value :\n        value.text,\n    renderResult(data) {\n        return this._options.getValue(data);\n    },\n    sanitize: (input) => $.sanitize(input),\n    isMatch(data, term) {\n        const value = this._options.getValue(data);\n        const escapedTerm = $._escapeRegExp(term);\n        const regExp = new RegExp(escapedTerm, 'i');\n\n        if (regExp.test(value)) {\n            return true;\n        }\n\n        const normalized = value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n        return regExp.test(normalized);\n    },\n    sortResults(a, b, term) {\n        const aLower = this._options.getValue(a).toLowerCase();\n        const bLower = this._options.getValue(b).toLowerCase();\n\n        if (term) {\n            const diff = aLower.indexOf(term) - bLower.indexOf(term);\n\n            if (diff) {\n                return diff;\n            }\n        }\n\n        return aLower.localeCompare(bLower);\n    },\n    minSearch: 1,\n    debounce: 250,\n    duration: 100,\n    maxHeight: '250px',\n    appendTo: null,\n    fullWidth: false,\n    placement: 'bottom',\n    position: 'start',\n    fixed: false,\n    spacing: 0,\n    minContact: false,\n};\n\n// Default classes\nAutocomplete.classes = {\n    active: 'active',\n    focus: 'focus',\n    info: 'autocomplete-item text-body-secondary',\n    item: 'autocomplete-item',\n    items: 'autocomplete-items',\n    menu: 'autocomplete-menu',\n};\n\n// Autocomplete prototype\nconst proto = Autocomplete.prototype;\n\nproto._events = _events;\nproto._getDataInit = _getDataInit;\nproto._getResultsCallbackInit = _getResultsCallbackInit;\nproto._getResultsInit = _getResultsInit;\nproto._render = _render;\nproto._renderInfo = _renderInfo;\nproto._renderItem = _renderItem;\nproto._renderResults = _renderResults;\n\n// Autocomplete init\ninitComponent('autocomplete', Autocomplete);\n\nexport default Autocomplete;\n","import $ from '@fr0st/query';\n\n/**\n * Attach events for the Autocomplete.\n */\nexport function _events() {\n    $.addEventDelegate(this._menuNode, 'contextmenu.ui.autocomplete', '[data-ui-action=\"select\"]', (e) => {\n        // prevent menu node from showing right click menu\n        e.preventDefault();\n    });\n\n    $.addEventDelegate(this._menuNode, 'mousedown.ui.autocomplete', '[data-ui-action=\"select\"]', (e) => {\n        // prevent selection from triggering blur event\n        e.preventDefault();\n    });\n\n    $.addEvent(this._node, 'blur.ui.autocomplete', (_) => {\n        if ($.isSame(this._node, document.activeElement)) {\n            return;\n        }\n\n        $.stop(this._menuNode);\n        $.removeDataset(this._menuNode, 'uiAnimating');\n\n        this.hide();\n    });\n\n    $.addEventDelegate(this._menuNode, 'mouseup.ui.autocomplete', '[data-ui-action=\"select\"]', (e) => {\n        e.preventDefault();\n\n        const value = $.getDataset(e.currentTarget, 'uiValue');\n\n        if (value !== $.getValue(this._node)) {\n            $.setValue(this._node, value);\n            $.triggerEvent(this._node, 'change.ui.autocomplete');\n        }\n\n        this.hide();\n        $.focus(this._node);\n    });\n\n    $.addEventDelegate(this._menuNode, 'mouseover.ui.autocomplete', '[data-ui-action=\"select\"]', $.debounce((e) => {\n        const focusedNode = $.find('[data-ui-focus]', this._menuNode);\n        $.removeClass(focusedNode, this.constructor.classes.focus);\n        $.removeDataset(focusedNode, 'uiFocus');\n\n        $.addClass(e.currentTarget, this.constructor.classes.focus);\n        $.setDataset(e.currentTarget, { uiFocus: true });\n\n        const id = $.getAttribute(e.currentTarget, 'id');\n        $.setAttribute(this._node, { 'aria-activedescendent': id });\n    }));\n\n    $.addEvent(this._node, 'input.ui.autocomplete', $.debounce((_) => {\n        this.show();\n\n        const term = $.getValue(this._node);\n        this._getData({ term });\n    }));\n\n    $.addEvent(this._node, 'keydown.ui.autocomplete', (e) => {\n        if (!['ArrowDown', 'ArrowUp', 'Enter'].includes(e.code)) {\n            return;\n        }\n\n        const focusedNode = $.findOne('[data-ui-focus]', this._menuNode);\n\n        if (e.code === 'Enter') {\n            // select the focused item\n            if (focusedNode) {\n                const value = $.getDataset(focusedNode, 'uiValue');\n\n                if (value !== $.getValue(this._node)) {\n                    $.setValue(this._node, value);\n                    $.triggerEvent(this._node, 'change.ui.autocomplete');\n                }\n\n                this.hide();\n            }\n\n            return;\n        }\n\n        e.preventDefault();\n\n        if (!$.isConnected(this._menuNode)) {\n            return this.show();\n        }\n\n        // focus the previous/next item\n\n        let focusNode;\n        if (!focusedNode) {\n            focusNode = this._activeItems[0];\n        } else {\n            let focusIndex = this._activeItems.indexOf(focusedNode);\n\n            switch (e.code) {\n                case 'ArrowDown':\n                    focusIndex++;\n                    break;\n                case 'ArrowUp':\n                    focusIndex--;\n                    break;\n            }\n\n            focusNode = this._activeItems[focusIndex];\n        }\n\n        if (!focusedNode && !focusNode && !this._request) {\n            const term = $.getValue(this._node);\n            return this._getData({ term });\n        }\n\n        if (!focusNode) {\n            return;\n        }\n\n        $.removeClass(focusedNode, this.constructor.classes.focus);\n        $.removeDataset(focusedNode, 'uiFocus');\n        $.addClass(focusNode, this.constructor.classes.focus);\n        $.setDataset(focusNode, { uiFocus: true });\n\n        const id = $.getAttribute(focusNode, 'id');\n        $.setAttribute(this._node, { 'aria-activedescendent': id });\n\n        const itemsScrollY = $.getScrollY(this._menuNode);\n        const itemsRect = $.rect(this._menuNode, { offset: true });\n        const nodeRect = $.rect(focusNode, { offset: true });\n\n        if (nodeRect.top < itemsRect.top) {\n            $.setScrollY(this._menuNode, itemsScrollY + nodeRect.top - itemsRect.top);\n        } else if (nodeRect.bottom > itemsRect.bottom) {\n            $.setScrollY(this._menuNode, itemsScrollY + nodeRect.bottom - itemsRect.bottom);\n        }\n    });\n\n    $.addEvent(this._node, 'keyup.ui.autocomplete', (e) => {\n        if (e.code !== 'Escape' || !$.isConnected(this._menuNode)) {\n            return;\n        }\n\n        // prevent node from closing modal\n        e.stopPropagation();\n\n        this.hide();\n    });\n\n    if (this._options.getResults) {\n        // infinite scrolling event\n        $.addEvent(this._menuNode, 'scroll.ui.autocomplete', $._throttle((_) => {\n            if (this._loadingScroll || !this._showMore) {\n                return;\n            }\n\n            const height = $.height(this._menuNode);\n            const scrollHeight = $.height(this._menuNode, { boxSize: $.SCROLL_BOX });\n            const scrollTop = $.getScrollY(this._menuNode);\n\n            if (scrollTop >= scrollHeight - height - (height / 4)) {\n                const term = $.getValue(this._node);\n                const offset = this._data.length;\n\n                this._loadingScroll = true;\n                this._getData({ term, offset });\n            }\n        }, 250, { leading: false }));\n    }\n};\n","import $ from '@fr0st/query';\n\n/**\n * Initialize preloaded get data.\n */\nexport function _getDataInit() {\n    this._getData = ({ term = null }) => {\n        this._activeItems = [];\n        $.empty(this._menuNode);\n        $.setAttribute(this._node, { 'aria-activedescendent': '' });\n\n        let results;\n\n        // check for minimum search length\n        if (this._options.minSearch && (!term || term.length < this._options.minSearch)) {\n            results = [];\n        } else {\n            const isMatch = this._options.isMatch.bind(this);\n            const sortResults = this._options.sortResults.bind(this);\n\n            // filter results\n            results = this._data.filter((data) => isMatch(data, term))\n                .sort((a, b) => sortResults(a, b, term));\n        }\n\n        this._renderResults(results);\n        this.update();\n    };\n};\n\n/**\n * Initialize get data callback.\n */\nexport function _getResultsCallbackInit() {\n    this._getResults = (options) => {\n        // reset data for starting offset\n        if (!options.offset) {\n            this._data = [];\n        }\n\n        const request = Promise.resolve(this._options.getResults(options));\n\n        request.then((response) => {\n            this._data.push(...response.results);\n            this._showMore = response.showMore;\n        }).catch((_) => { });\n\n        return request;\n    };\n};\n\n/**\n * Initialize get data from callback.\n */\nexport function _getResultsInit() {\n    const load = $._debounce(({ offset, term }) => {\n        const options = { offset };\n\n        if (term) {\n            options.term = term;\n        }\n\n        const request = this._getResults(options);\n\n        request.then((response) => {\n            if (this._request !== request) {\n                return;\n            }\n\n            if (!offset) {\n                $.empty(this._menuNode);\n            } else {\n                $.detach(this._loader);\n            }\n\n            this._renderResults(response.results);\n\n            this._request = null;\n        }).catch((_) => {\n            if (this._request !== request) {\n                return;\n            }\n\n            $.detach(this._loader);\n            $.append(this._menuNode, this._error);\n\n            this._request = null;\n        }).finally((_) => {\n            this._loadingScroll = false;\n            this.update();\n        });\n\n        this._request = request;\n    }, this._options.debounce);\n\n    this._getData = ({ offset = 0, term = null }) => {\n        // cancel last request\n        if (this._request && this._request.cancel) {\n            this._request.cancel();\n        }\n\n        this._request = null;\n\n        if (!offset) {\n            this._activeItems = [];\n            $.setAttribute(this._node, { 'aria-activedescendent': '' });\n\n            const children = $.children(this._menuNode, (node) => !$.isSame(node, this._loader));\n            $.detach(children);\n        } else {\n            $.detach(this._error);\n        }\n\n        // check for minimum search length\n        if (this._options.minSearch && (!term || term.length < this._options.minSearch)) {\n            $.hide(this._menuNode);\n            this.update();\n            return;\n        }\n\n        $.show(this._menuNode);\n\n        const lastChild = $.child(this._menuNode, ':last-child');\n        if (!lastChild || !$.isSame(lastChild, this._loader)) {\n            $.append(this._menuNode, this._loader);\n        }\n\n        load({ offset, term });\n    };\n};\n","import $ from '@fr0st/query';\nimport { generateId } from '@fr0st/ui';\n\n/**\n * Render the toggle element.\n */\nexport function _render() {\n    const id = generateId('autocomplete');\n\n    this._menuNode = $.create('div', {\n        class: this.constructor.classes.menu,\n        style: { maxHeight: this._options.maxHeight },\n        attributes: {\n            id,\n            role: 'listbox',\n        },\n    });\n\n    if (this._options.getResults) {\n        this._loader = this._renderInfo(this._options.lang.loading);\n        this._error = this._renderInfo(this._options.lang.error);\n    }\n\n    this._popperOptions = {\n        reference: this._node,\n        placement: this._options.placement,\n        position: this._options.position,\n        fixed: this._options.fixed,\n        spacing: this._options.spacing,\n        minContact: this._options.minContact,\n    };\n\n    if (this._options.fullWidth) {\n        this._popperOptions.beforeUpdate = (node) => {\n            $.setStyle(node, { width: '' });\n        };\n\n        this._popperOptions.afterUpdate = (node, reference) => {\n            const width = $.width(reference, { boxSize: $.BORDER_BOX });\n            $.setStyle(node, { width: `${width}px` });\n        };\n    }\n\n    $.setAttribute(this._node, {\n        'role': 'combobox',\n        'aria-controls': id,\n        'aria-autocomplete': 'list',\n        'aria-expanded': false,\n        'aria-activedescendent': '',\n    });\n};\n\n/**\n * Render an information item.\n * @param {string} text The text to render.\n * @return {HTMLElement} The information item.\n */\nexport function _renderInfo(text) {\n    const element = $.create('div', {\n        html: this._options.sanitize(text),\n        class: this.constructor.classes.info,\n    });\n\n    return element;\n};\n\n/**\n * Render an item.\n * @param {string|object} data The data to render.\n * @return {HTMLElement} The item element.\n */\nexport function _renderItem(data) {\n    const id = generateId('autocomplete-item');\n\n    const value = this._options.getValue(data);\n\n    const element = $.create('button', {\n        class: this.constructor.classes.item,\n        attributes: {\n            id,\n            type: 'button',\n            role: 'option',\n        },\n        dataset: {\n            uiAction: 'select',\n            uiValue: value,\n        },\n    });\n\n    this._activeItems.push(element);\n\n    if ($.getValue(this._node) === value) {\n        $.addClass(element, this.constructor.classes.active);\n    }\n\n    const content = this._options.renderResult.bind(this)(data, element);\n\n    if ($._isString(content)) {\n        $.setHTML(element, this._options.sanitize(content));\n    } else if ($._isElement(content) && !$.isSame(element, content)) {\n        $.append(element, content);\n    }\n\n    return element;\n};\n\n/**\n * Render results.\n * @param {array} results The results to render.\n */\nexport function _renderResults(results) {\n    if (!results.length) {\n        $.hide(this._menuNode);\n        return;\n    }\n\n    $.show(this._menuNode);\n\n    for (const item of results) {\n        const element = this._renderItem(item);\n        $.append(this._menuNode, element);\n    }\n\n    const focusedNode = $.findOne('[data-ui-focus]', this._menuNode);\n\n    if (focusedNode) {\n        return;\n    }\n\n    let focusNode = $.findOne('[data-ui-active]', this._menuNode);\n\n    if (!focusNode) {\n        focusNode = $.findOne('[data-ui-action=\"select\"]', this._menuNode);\n    }\n\n    if (focusNode) {\n        $.addClass(focusNode, this.constructor.classes.focus);\n        $.setDataset(focusNode, { uiFocus: true });\n\n        const id = $.getAttribute(focusNode, 'id');\n        $.setAttribute(this._node, { 'aria-activedescendent': id });\n    }\n};\n"],"mappings":"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"}